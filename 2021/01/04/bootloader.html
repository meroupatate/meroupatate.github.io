<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation | meroupatate</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="During my Arch Linux installation, I accidentally formatted the EFI system partition created by my existing Windows installation and replaced it with a new EFI system that starts Arch Linux using systemd-boot. While my initial goal was to have a Windows 10 / Arch Linux dual boot, I am currently only able to boot under Arch since I deleted my Windows Boot Manager files." />
<meta property="og:description" content="During my Arch Linux installation, I accidentally formatted the EFI system partition created by my existing Windows installation and replaced it with a new EFI system that starts Arch Linux using systemd-boot. While my initial goal was to have a Windows 10 / Arch Linux dual boot, I am currently only able to boot under Arch since I deleted my Windows Boot Manager files." />
<link rel="canonical" href="https://meroupatate.github.io/2021/01/04/bootloader.html" />
<meta property="og:url" content="https://meroupatate.github.io/2021/01/04/bootloader.html" />
<meta property="og:site_name" content="meroupatate" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation" />
<script type="application/ld+json">
{"description":"During my Arch Linux installation, I accidentally formatted the EFI system partition created by my existing Windows installation and replaced it with a new EFI system that starts Arch Linux using systemd-boot. While my initial goal was to have a Windows 10 / Arch Linux dual boot, I am currently only able to boot under Arch since I deleted my Windows Boot Manager files.","@type":"BlogPosting","headline":"How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation","dateModified":"2021-01-04T00:00:00+00:00","datePublished":"2021-01-04T00:00:00+00:00","url":"https://meroupatate.github.io/2021/01/04/bootloader.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://meroupatate.github.io/2021/01/04/bootloader.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="https://meroupatate.github.io/feed.xml" title="meroupatate" /></head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">meroupatate<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/meroupatate"><i class="fab fa-twitter-square"></i></a><a class="color-purple-hover" href="https://github.com/meroupatate"><i class="fab fa-github-square"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">

Hi there, I am Alice and I am a French engineering student at Télécom SudParis.
</div>


<div class="post">
  <h1 class="post-title">How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/windows/">windows</a>
      
      <a class="tag" href="/tag/arch/">arch</a>
      
      <a class="tag" href="/tag/linux/">linux</a>
      
      <a class="tag" href="/tag/dual-boot/">dual-boot</a>
      
      <a class="tag" href="/tag/bootloader/">bootloader</a>
      
      <a class="tag" href="/tag/systemd-boot/">systemd-boot</a>
      
  </div>
  
  <div class="post-date">Published on 04 Jan 2021</div>
  
  <p>During my Arch Linux installation, I accidentally formatted the EFI system partition created by my existing Windows installation and replaced it with a new EFI system that starts Arch Linux using <code class="language-plaintext highlighter-rouge">systemd-boot</code>.
While my initial goal was to have a Windows 10 / Arch Linux dual boot, I am currently only able to boot under Arch since I deleted my Windows Boot Manager files.</p>

<p>In this article, I will describe how I managed to reinstall Windows Boot Manager on my EFI system and create a Windows 10 entry in systemd-boot.</p>

<h2 id="current-partitions">Current partitions</h2>

<p>Here is the list of my partitions after my Arch installation:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>fdisk <span class="nt">-l</span>
Device          Start        End    Sectors   Size Type
/dev/sda1        2048     534527     532480   260M EFI System
/dev/sda2      534528     567295      32768    16M Microsoft reserved
/dev/sda3      567296  926358296  925791001 441.5G Microsoft basic data
/dev/sda4   926359552  927473663    1114112   544M Windows recovery environment
/dev/sda5   927475712 1951475711 1024000000 488.3G Linux filesystem
/dev/sda6  1951475712 1953523711    2048000  1000M Windows recovery environment
</code></pre></div></div>

<p>As you can see, my Linux filesystem is <code class="language-plaintext highlighter-rouge">/dev/sda5</code> and my Windows filesystem is <code class="language-plaintext highlighter-rouge">/dev/sda3</code>. The other partitions are managed by the Windows installation: <code class="language-plaintext highlighter-rouge">/dev/sda2</code> is a <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/configure-uefigpt-based-hard-drive-partitions#microsoft-reserved-partition-msr">Microsoft reserved partition</a> and both <code class="language-plaintext highlighter-rouge">/dev/sda4</code> and <code class="language-plaintext highlighter-rouge">/dev/sda6</code> are recovery partitions (<a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/configure-uefigpt-based-hard-drive-partitions#recovery-tools-partition">Windows RE</a>) automatically created by Windows 10.</p>

<p>Here, the interesting partition is <code class="language-plaintext highlighter-rouge">/dev/sda1</code>, which is the EFI system mounted as <code class="language-plaintext highlighter-rouge">/boot</code> for my Linux installation. As I mentioned before, this partition was initially a <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/configure-uefigpt-based-hard-drive-partitions#system-partition">System partition</a> managed by Windows, but since I formatted the partition during my Linux installation, I now need to restore my Windows Boot Manager files on the partition in order to be able to boot both Windows 10 and Linux.</p>

<h2 id="restoring-the-windows-boot-manager-files">Restoring the Windows Boot Manager files</h2>

<p>The first step is to create a bootable USB drive for Windows 10. The Windows 10 ISO can be downloaded from the <a href="https://www.microsoft.com/en-us/software-download/windows10ISO">Microsoft website</a>. Since the image uses around 6GB disk space, I got a 16GB USB drive to make sure I have enough disk space for the ISO image. It is important that this USB drive contains no useful data since the filesystem will be completely overwritten by the Windows ISO image.</p>

<p>As shown in the following command output, my USB drive is detected as the new device <code class="language-plaintext highlighter-rouge">/dev/sdb</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>lsblk
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda              8:0    0 931.5G  0 disk
├─sda1           8:1    0   260M  0 part  /boot
├─sda2           8:2    0    16M  0 part
├─sda3           8:3    0 441.5G  0 part
├─sda4           8:4    0   544M  0 part
├─sda5           8:5    0 488.3G  0 part
│ └─LVM        254:0    0 488.3G  0 crypt
│   ├─mvg-swap 254:1    0    20G  0 lvm   <span class="o">[</span>SWAP]
│   ├─mvg-root 254:2    0    40G  0 lvm   /
│   └─mvg-home 254:3    0 428.3G  0 lvm   /home
└─sda6           8:6    0  1000M  0 part
sdb              8:16   1  14.8G  0 disk
└─sdb1           8:17   1  14.8G  0 part
</code></pre></div></div>

<p>To override all data within the USB drive with the Windows 10 ISO, I installed <code class="language-plaintext highlighter-rouge">woeusb</code> from AUR. <code class="language-plaintext highlighter-rouge">woeusb</code> is a tool to create a bootable Windows USB drive since <a href="https://wiki.archlinux.org/index.php/USB_flash_installation_medium#BIOS_and_UEFI_bootable_USB">standard ways of copying ISO to a USB drive</a> do not work with Windows images.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>woeusb <span class="nt">--target-filesystem</span> NTFS <span class="nt">--device</span> Win10_20H2_v2_French_x64.iso /dev/sdb
</code></pre></div></div>

<p>Once the command has finished its execution, I rebooted from the newly created Windows installation drive (by changing the UEFI boot order in BIOS) and landed in the Windows installation screen.</p>

<p>I then found a thread where Mark S. described how to create a lost EFI partition from an installation media. Since I already had an existing EFI system partition, I skipped the steps used to create and format the partition and only run the following steps:</p>
<ul>
  <li>Press <code class="language-plaintext highlighter-rouge">SHIFT+F10</code> on the Windows installation screen to open a command-line interpreter.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">diskpart</code> to launch the disk management tool DiskPart.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">list disk</code> in DiskPart to get a list of existing disks.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">select disk N</code> where <code class="language-plaintext highlighter-rouge">N</code> refers to the number of the disk which contains our EFI system partition (for me it was Disk 0 so I ran <code class="language-plaintext highlighter-rouge">select disk 0</code>).
<img src="/assets/bootloader-01.jpg" alt="" /></li>
  <li>Run <code class="language-plaintext highlighter-rouge">list volume</code> to get the list of the partitions in this disk.
<img src="/assets/bootloader-02.jpg" alt="" /></li>
  <li>Find the letter corresponding to the volume with the existing Windows filesystem (in my case it is <code class="language-plaintext highlighter-rouge">C</code> since <code class="language-plaintext highlighter-rouge">Volume 0</code> is listed as my Windows filesystem).</li>
  <li>Exit DiskPart by running <code class="language-plaintext highlighter-rouge">exit</code>.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">bcdboot X:\Windows</code> where <code class="language-plaintext highlighter-rouge">X</code> is the letter found in the previous step. This command should copy the boot files from the Windows partition to our existing EFI system partition so that an entry will be created by <code class="language-plaintext highlighter-rouge">systemd-boot</code>.
<img src="/assets/bootloader-03.jpg" alt="" /></li>
</ul>

<p>I then restarted and went back to the BIOS to change the default boot device back to <code class="language-plaintext highlighter-rouge">Linux Boot Loader</code>.</p>

<p><img src="/assets/bootloader-04.jpg" alt="" /></p>

<p>An new entry called <code class="language-plaintext highlighter-rouge">Windows Boot Manager</code> has been created right below my <code class="language-plaintext highlighter-rouge">Arch Linux</code> entry and I now have an operational dual boot ! :D</p>

</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'https://meroupatate.github.io/2021/01/04/bootloader.html';
     this.page.identifier = '/2021/01/04/bootloader';
     this.page.title = 'How to restore an accidentally deleted Windows Boot Manager with a Windows / Arch Linux dual-boot installation';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//meroupatate-github-io.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/05/03/airpods.html">
            How to connect Airpods to Arch Linux with PulseAudio
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/05/02/gurumeditation.html">
            A possible reason for your Virtualbox VM entering the "gurumeditation" state
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/airpods/" class="set-1">airpods</a> <a href="/tag/arch/" class="set-5">arch</a> <a href="/tag/bluetooth/" class="set-1">bluetooth</a> <a href="/tag/bootloader/" class="set-1">bootloader</a> <a href="/tag/dual-boot/" class="set-1">dual-boot</a> <a href="/tag/gurumeditation/" class="set-1">gurumeditation</a> <a href="/tag/linux/" class="set-5">linux</a> <a href="/tag/pulseaudio/" class="set-1">pulseaudio</a> <a href="/tag/systemd-boot/" class="set-1">systemd-boot</a> <a href="/tag/virtualbox/" class="set-1">virtualbox</a> <a href="/tag/windows/" class="set-1">windows</a></div>
  



      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
